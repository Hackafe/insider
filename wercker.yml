box: nodesource/trusty

build:
  steps:
    - script:
        name: echo nodejs information
        code: |
          echo "node version $(node -v) running"
          echo "npm version $(npm -v) running"

    - npm-install
    - npm-test


deploy:
  steps:
    - add-to-known_hosts:
        hostname: $SERVER_HOSTNAME
        port: $SERVER_PORT
    - add-ssh-key:
        keyname: DOKKU
    - script:
        name: Add remote
        code: |
          git remote add dokku ssh://dokku@$SERVER_HOSTNAME:$SERVER_PORT/insider
    - script:
        name: Debug env
        code: |
          cat /root/.ssh/config
          cat /etc/ssh/ssh_known_hosts
          git remote -v
          ssh -p $SERVER_PORT dokku@$SERVER_HOSTNAME apps
    - script:
        name: Push to dokku
        code: |
          git push dokku master -f
